<!DOCTYPE html>
<html>

<head>
    <title>Newsletter templater</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="stylesheet" href="/codemirror-5.49.2/lib/codemirror.css">
    <style type="text/css">
    html, body {
        height: 100%;
    }

    .column {
        float: left;
        width: 48%;
        height: 100%;
        padding: 0 5px 5px 5px;
    }

    /* Clear floats after the columns */
    .row:after {
        content: "";
        display: table;
        clear: both;
    }
    </style>

        <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/codemirror/CodeMirror/master/lib/codemirror.css">
        <link rel="stylesheet" type="text/css" href="codemirror-5.49.2/theme/ambiance.css">
        <script type="text/javascript" src="codemirror-5.49.2/lib/codemirror.js"></script>
        <script type="text/javascript" src="https://cdn.rawgit.com/codemirror/CodeMirror/master/mode/xml/xml.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="mustache.js/mustache.js"></script>
</head>

<body style="margin: 0 !important; padding: 0 !important;">
<script>
    var template;
    var editor;
    $( document ).ready(function() {

        $.get("input.tmpl", function(resp) {
            template = resp;
        }, "text");

        $.get("default.data", function(resp) {
            $("#editor").val(resp);
            editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
                lineNumbers: true,
                mode:  {name: "javascript", json: true},
                theme: "ambiance"
            });
            editor.setOption("extraKeys", {
                CodeMirror.keyNames.Ctrl-Space: function(cm) {
                    alert("AHHHHH");
                    // var spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
                    // cm.replaceSelection(spaces);
                }
                });
            editor.setSize(null, "100%");

        }, "text");


        $("#run").click(function(){
            try{
                var data = editor.getValue();
                var rendered = Mustache.render(template, JSON.parse(data));
                $('#rendered_output').html(rendered);
                $('#text_output').val(rendered);
            }catch(err){
                $('#rendered_output').html(err);
            }
            });

    });
</script>

<div class="row" style="height: 95%">
    <!-- <div class="column" style="height: 100%"> <textarea style="width: 100%; height: 100%;" id="editor"></textarea> </div> -->
    <div class="column"> <textarea id="editor"></textarea> </div>

    <div class="column"><div style="height: 100%; overflow:scroll" id="rendered_output">Ersetzen klicken</div></div>

    <div  style="display: none;"> <textarea id="text_output"></textarea> </div>
</div>
<div class="row">
    <div class="column"><button id="run" type="button">Ersetzen</button></div>
</div>
</body>

</html>
